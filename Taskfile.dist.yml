# Ensure you have task installed:
# https://taskfile.dev

version: '3'

vars:
  GREETING: Task is running!

tasks:
  default:
    cmds:
      - echo "{{.GREETING}}"
    silent: true

  clean:
    cmds:
      - rm -vrf dist
      - rm -vrf build

  build:app:
    cmds:
      - bun run build

  build:
    deps: [build:app]
    cmds:
      - docker build -t passage .

  test:
    deps: [launch]
    cmds:
      - defer: {task: teardown}
      - bun run test

  test:coverage:
    cmds:
      - bun run test-coverage

  test:watch:
    cmds:
      - bun run test-watch

  server:
    cmds:
      - bun run express

  server:dev:
    cmds:
      - bun run express-dev

  launch:
    cmds:
      - docker-compose up -d

  teardown:
    cmds:
      - docker-compose down

  docs:start:
    desc: "Start Docusaurus development server"
    cmds:
      - bun run docs:start

  docs:build:
    desc: "Build Docusaurus static site"
    cmds:
      - bun run docs:build

  docs:serve:
    desc: "Serve built Docusaurus site locally"
    cmds:
      - bun run docs:serve

  docs:clear:
    desc: "Clear Docusaurus cache"
    cmds:
      - bun run docs:clear

  # Future dev tool
#  dx-import-idea:
#    prompt: "This will overwrite existing JetBrains configs, are you sure?"
#    cmds:
#      - echo "Not implemented yet"

